<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITyping</title>
    <link rel="stylesheet" href="style.css">
    <script src="./anime.min.js"></script>
</head>
<body>
    <div class="audio">
        <audio id="countSound" src="カウントダウン.mp3"></audio>
        <audio id="lastCountSound" src="カウントダウンラスト.mp3"></audio>
        <audio id="clearSound" src="クリア.mp3"></audio>
        <audio id="typingSound" src="タイピング音.mp3"></audio>
        <audio id="missSound" src="ミス.mp3"></audio>
        <audio id="resultSound" src="リザルト.mp3"></audio>
        <audio id="btnSound" src="各ボタン音.mp3"></audio>
    </div>
    <div id="startPage" class="text-container">
        <h1 class="game-title">ITyping</h1>
        <div class="buttons">
            <button id="startBtn" class="start-button">start</button>
            <button id="detailsBtn" class="start-button">details</button>
        </div>
    </div>
    <div id="detailsPage" class="text-container hidden">
        <div class="details">
            <h1 class="details-headline">・About this game</h1>
            <p class="details-text">This game was created by a boy who has been learning programming for two months. The rules of this game are simple. When the start button is pressed, a countdown begins. Once the game begins, the player is asked to enter 10 random IT-related words as quickly and accurately as possible. Once all the words are typed, the results screen appears, showing the time it took to complete the game, the number of spelling errors, WPM, accuracy, and score. The score is calculated as (WPM x accuracy). The benefits of playing this game are to improve your typing speed and accuracy, to learn more about IT terms, and to pass the time. Let's be careful not to get so absorbed in the game that we forget what we really need to do now. Joking aside, thank you for reading this long, long explanation. I did my best to write this text because I wanted to partially implement scrollbars and see how they actually appear. I would like to end with an explanation of the WPM that can be measured in this game.</p><br>
            <h1 class="details-headline">・About WPM</h1>
            <p class="details-text">Words Per Minute refers to the number of words typed per minute in English typing. Strictly speaking, however, it is a little different. Let us explain with an easy-to-understand example.<br><br>

                1. I am good at piano<br>
                2.You speak Japanese pretty well<br><br>
                
                Both 1 and 2 have 5 words, but the number of keys to input is 18 for 1 and 30 for 2.<br>
                (*Not only alphabets, but also spaces, periods, commas, etc. are counted as one key.)<br><br>
                
                Thus, even if the number of words is the same, the number of keys to be entered may differ greatly. Therefore, regardless of the actual number of words entered, the five keys entered are calculated as one word.<br><br>
                
                So, if you can type 200 keys per minute, that is 40 wpm. 200 kpm = 40 wpm<br><br>
                
                It is important to remember that WPM is the standard for speed in English typing.</p>
        </div>
        <div id="backBtn" class="menu-button">menu</div>
    </div>
    <div id="countdown" class="text-container hidden">
        <div id="second" class="countdown"></div>
    </div>
    <div id="game" class="text-container hidden">
        <label for="inputText">
            <div class="question">
                <span id="entered" class="marker"></span>
                <span id="remained" class="premarker"></span>
            </div>
            <input type="text" class="text" id="inputText" autofocus autocomplete="off" >
        </label>
    </div>

    <div id="message" class="text-container hidden">
        <div class="end-sentence">
            <div class="results">
                <div id="time" class="timer"></div>
                <div id="miss" class="miss-count"></div>
                <div id="WPM" class="words-per-minute"></div>
                <div id="accuracyLate" class="accuracy-late"></div>
                <div id="score" class="game-score"></div>
            </div>
            <siv class="buttons">
                <button id="replayBtn" class="replay-button">menu</button>
                <button id="rankBtn" class="replay-button hidden">rank</button>
            </div>
        </div>
    </div>
    <div id="rankPage" class="text-container hidden">
        <div class="rankings">
            <div id="ranking" class="points">coming soon</div>
        </div>
        <button id="returnBtn" class="replay-button">return</button>
    </div>

    <script>
    'use strict';

    const questions = [
    "algorithm", "API", "application", "backup", "bandwidth", "binary", "bit", "byte", 
    "cache", "client", "cloud", "compiler", "compression", "cookie", "CPU", "database",
    "debug", "desktop", "development", "disk", "DNS", "domain", "driver", "email",
    "encryption", "firewall", "firmware", "frontend", "FTP", "gigabyte",
    "graphics","GUI","hardware","HTML","HTTP","HTTPS","hyperlink",
    "IDE","index","internet","IP","Java","JavaScript","kernel","keyboard",
    "LAN","link","Linux","login","malware","memory","monitor",
    "motherboard","mouse","multimedia","network","node",
    "offline","online","opensource","operatingsystem",
    "password","PHP","pixel","platform",
    "protocol","Python","query",
    "RAM","resolution",
    "router","runtime",
    "scriptinglanguage","Ajax", "algorithmic", "applet", "argument", "array", "ASP.NET", "assembler", 
    "asynchronous", "authentication", "backdoor", "bandpass", "baseband", 
    "benchmarking", "BIOS", "bitrate", "blockchain", "Bluetooth",
    "bookmark", "booting", "botnet", "breadcrumb", "broadband",
    "buffer", "bugfix", "busbar", "bytecode",
    "C++", "callback", "CAPTCHA",
    "chipset","CLI","client-server","clipboard",
    "COBOL","codec","commandline","comment","compiler",
    "computing","concatenation","conditional","configuration",
    "connectivity","constructor","container",
    "CORS","crawling","cryptography",
    "CSS","CSV","cybersecurity",
    "daemon","dataflow","datagram",
    "debugger","decryption","defragmentation",
    "dequeue","dereference","DHCP","daemon","dataflow","datagram",
    "debugger","decryption","defragmentation","dequeue","dereference","DHCP","dialup","digital","diode",
    "directx","disassembler","DLL","DNSSEC","doctype",
    "DOM","dotnet","download","drag-and-drop",
    "DSL","DTD","dualboot",
    "Eclipse","ECMAScript","edgecomputing",
    "EEPROM","EIGRP","Elasticsearch",
    "embed","emoji","emulator",
    "encryptionkey","endpoint",
    "EntityFramework",
    "EPROM","Ethernet",
    "eventhandler",
    "exceptionhandling",
    "executable",
    "Express.js",
    "extranet",
    "failover",
    "favicon",
    "FDDI",
    "fetchAPI",
    "FiberOptic","FIFO", "fileserver", "firewire", "firmware", "flash", "flavor", "floatingpoint",
    "flowchart", "flush", "font", "formfactor", "framework", "frontend",
    "fullstack", "functionality", "gaming", "gateway", 
    "GCC", "GIF", "git", "glitch", 
    "globbing", "Golang","gradient","graphicscard","grid", "gzip", "hackathon", "handle", "hashing", "haskell", 
    "header", "heap", "hexadecimal", "hierarchy", "hosting", 
    "HTML5", "HTTP2", "HTTPS", "hyperthreading", 
    "IDE", "iframe", "IMAP", "immutable","inheritance", "input", "instance", "integer", "interface", 
    "interpreter", "IoT", "iteration", "JavaFX", 
    "JDK", "JIT", "join", "JSON", 
    "JVM", "keyframe", "keyword","lambda", "LAN", "laptop", "latency", "layer", 
    "LDAP", "library", "linker", "Linux", 
    "list", "localhost", "lock", "logarithm", 
    "login", "loop", "machinelearning",
];

    const entered          = document.getElementById('entered');
    const remained         = document.getElementById('remained');
    const inputText        = document.getElementById('inputText');
    const game             = document.getElementById('game');
    const message          = document.getElementById('message');
    const replayBtn        = document.getElementById('replayBtn');
    const startBtn         = document.getElementById('startBtn');
    const backBtn          = document.getElementById('backBtn');
    const detailsBtn       = document.getElementById('detailsBtn');
    const rankBtn          = document.getElementById('rankBtn');
    const returnBtn        = document.getElementById('returnBtn');
    const startPage        = document.getElementById('startPage');
    const detailsPage      = document.getElementById('detailsPage');
    const rankPage         = document.getElementById('rankPage');
    const timeElement      = document.getElementById('time');
    const countdownElement = document.getElementById('countdown');
    const second           = document.getElementById('second');
    const countSound       = document.getElementById('countSound');
    const lastCountSound   = document.getElementById('lastCountSound');
    const clearSound       = document.getElementById('clearSound');
    const typingSound      = document.getElementById('typingSound');
    const missSound        = document.getElementById('missSound');
    const resultSound      = document.getElementById('resultSound');
    const btnSound         = document.getElementById('btnSound');
    const miss             = document.getElementById('miss');
    const WPM              = document.getElementById('WPM');
    const accuracyLate     = document.getElementById('accuracyLate');
    const score            = document.getElementById('score');
    const ranking          = document.getElementById('ranking');

    let remainedTextWords = remained.textContent.split('');
    let enteredTextWords  = [];
    let sentences         = [];
    let currentKey;
    let currentText;
    let countdown;
    let missCount         = 0;
    let typeCount         = 0;
    let totalType         = 0;
    let scoreCount        = 0;

    //カウントダウン音
    function playCount() {
        countSound.currentTime = 0;
        countSound.play();
    }

    //ラストカウントダウン音
    function playLastCount() {
        lastCountSound.currentTime = 0;
        lastCountSound.play();
    }

    //クリア音
    function playClear() {
        clearSound.currentTime = 0;
        clearSound.play();
    }

    //タイピング音
    function playTyping() {
        typingSound.currentTime = 0;
        typingSound.play();
    }

    //ミス音
    function playMiss() {
        missSound.currentTime = 0;
        missSound.play();
    }

    //リザルト音
    function playResult() {
        resultSound.play();
    }

    //各ボタン音
    function playBtn() {
        resultSound.pause();
        resultSound.currentTime = 0;
        btnSound.currentTime = 0;
        btnSound.play();
    }

    //startボタンを押された時の処理
    startBtn.addEventListener('click', () => {
        playBtn(); //サウンド再生
        countdownElement.classList.remove('hidden');
        startPage.classList.add('hidden');
        let countdownTime = 3; // カウントダウンの時間（秒）

        // カウントダウンを開始
    countdown = setInterval(function() {
        if(countdownTime > 0) {
            if(Number.isInteger(countdownTime)) {
                playCount();
            };
            second.innerText = countdownTime;
            countdownTime--;
        } else {
            playLastCount();
            clearInterval(countdown);
            countdownElement.classList.add('hidden');
            game.classList.remove('hidden');
            inputText.focus();

     
        //配列questionからランダムで10個配列sentencesに代入
        for(let i = 0; i < 2; i++){
            let index = Math.floor(Math.random() * questions.length);
            sentences.push(questions[index]);
            questions.splice(index, 1);
        };

        // 新しい問題文をランダムにセットする関数
        const setQuestion = () => {

            // 問題文をランダムで選ぶ
            currentKey = Math.floor( Math.random() * sentences.length );
            currentText = sentences[ currentKey ];

            // 一度選ばれた問題は配列から削除
            sentences.splice(currentKey, 1);

            // 画面に新しい問題文をセット
            entered.textContent = '';
            remained.textContent = currentText;

            // これまでフォームに入力された値をリセット
            inputText.value = '';

            // 「入力済み文字」「未入力文字」の配列の中身をリセット
            enteredTextWords = [];
            remainedTextWords = currentText.split('');
        };
        setQuestion();

            //カウントスタート
            let startTime = performance.now();

        //入力された文字の正誤判定とその後の処理
        document.addEventListener('input', (e) => {

                //大文字小文字の識別なし
            if(remainedTextWords[0].toLowerCase() === e.data.toLowerCase()){

                //タイピング音
                playTyping();

                //正タイピング回数
                typeCount = typeCount + 1;

                // 入力済み文字の配列の最後に1文字追加
                enteredTextWords.push( remainedTextWords[0] );
                // 未入力文字の配列の先頭から1文字削除
                remainedTextWords.shift();

                // 入力済みテキスト＆未入力テキストを連結して画面表示
                entered.textContent = enteredTextWords.join('');
                remained.textContent = remainedTextWords.join('');

                // 全文字入力したら新しい問題文をセット
                if(remainedTextWords.length <= 0){
                    if(sentences.length <= 0){
                        playClear(); //サウンド再生
                        playResult(); //*
                        game.classList.add('hidden'); // ゲーム画面を非表示
                        message.classList.remove('hidden'); // 終了メッセージ表示
                        let endTime = performance.now();
                        let elapsedTime = endTime - startTime;
                        let elapsedTimeInSeconds = elapsedTime / 1000; // ミリ秒を秒に変換
                        timeElement.textContent = `time : ${elapsedTimeInSeconds.toFixed(2)} `; //タイム表示(小数点第2位)
                        let wpm = ((typeCount / elapsedTimeInSeconds) * 60) / 5; //wpmの計算
                        totalType = typeCount + missCount; //総タイプ数の計算
                        let accuracy = (typeCount / totalType) * 100; //正タイプ率の計算
                        accuracyLate.textContent = `accuracy : ${accuracy.toFixed(2)}%`; //正タイプ率の表示
                        WPM.textContent = `wpm : ${wpm.toFixed(2)}`; //wpmの表示
                        miss.textContent = `miss : ${missCount} `; //ミス数の表示
                        scoreCount = Math.round(wpm * accuracy); //スコアの計算
                        score.textContent = `score : ${scoreCount}`; //スコアの表示
                        }else{
                            playClear(); //サウンド再生
                            setQuestion(); // 新しい問題文をセット
                        }
                }
            }else{
                missCount = missCount + 1;
                playMiss(); //サウンド再生
            }
        });
    }
    }, 1000);
    });


    //rankボタンが押された時の処理
    rankBtn.addEventListener('click', () => {
        playBtn(); //サウンド再生
        rankPage.classList.remove('hidden');
        message.classList.add('hidden');
    });

    //returnボタンが押された時の処理
    returnBtn.addEventListener('click', () => {
        playBtn(); //サウンド再生
        message.classList.remove('hidden');
        rankPage.classList.add('hidden');
    });


    //detailsボタンが押された時の処理
    detailsBtn.addEventListener('click', () => {
        playBtn(); //サウンド再生
        detailsPage.classList.remove('hidden');
        startPage.classList.add('hidden');
    });

    //menuボタンが押された時の処理
    [backBtn, replayBtn].forEach(btn => {
    btn.addEventListener('click', () => {
        playBtn(); //サウンド再生
        setTimeout(()=> {window.location.reload();
        },300);
    });
    });
    
//ここからanime.js
//ゲームタイトルの動き
anime({
  targets: '.text-container .game-title',
  translateX: {
    value: [1000,0],
    duration: 800
  },
  rotate: {
    value: 360,
    duration: 1000,
    easing: 'easeInOutSine'
  },
  scale: {
    value: 1.3,
    duration: 1600,
    delay: 500,
    easing: 'easeInOutQuart'
  },
  delay: 250
});

//ボタン回転
anime({
    targets: '.text-container .start-button, .menu-button, .replay-button',
    rotate: {
        value: 360,
        duration: 3000,
        easing: 'linear'
    },
    loop: true
});

    </script>
</body>
</html>
